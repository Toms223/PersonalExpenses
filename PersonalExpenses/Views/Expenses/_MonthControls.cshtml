@using PersonalExpenses.Helpers.Expenses
@using PersonalExpenses.Model
@model PersonalExpenses.ViewModel.ExpensesView

<div class="month-controls">
    <div class="month-filter">
        <form method="get" action="/Expenses/Index">
            <label for="month">Month:</label>
            <select name="SelectedMonth">
                @foreach (MonthOfYear m in Model.MonthlyExpenses.FindAll(e => e.Year == (Model.SelectedYear == 0 ? DateTime.Now.Year : Model.SelectedYear)).Select(e => e.MonthOfYear))
                {
                    <option value="@((int)m)" @((MonthOfYear)Model.SelectedMonth == m ? "selected" : "")>@m</option>
                }
            </select>

            <label for="year">Year:</label>
            <select name="SelectedYear">
                @foreach (int y in Model.MonthlyExpenses.Select(e => e.Year))
                {
                    <option value="@(y)" @(Model.SelectedYear == y ? "selected" : "")>@y</option>
                }
            </select>
            
            @await Html.PartialAsync("_StateHiddenFields", Model)
            
            <button type="submit">Go</button>
        </form>
    </div>
    
    <div class="month-navigation">
        @{
            var prevMonth = (Model.SelectedMonth == 0 ? DateTime.Now.Month - 1 : Model.SelectedMonth) - 1;
            var prevYear = (Model.SelectedYear == 0 ? DateTime.Now.Year : Model.SelectedYear);
            if (prevMonth < 1) { prevMonth = 12; prevYear--; }

            var nextMonth = (Model.SelectedMonth == 0 ? DateTime.Now.Month - 1 : Model.SelectedMonth) + 1;
            var nextYear = (Model.SelectedYear == 0 ? DateTime.Now.Year : Model.SelectedYear);
            if (nextMonth > 12) { nextMonth = 1; nextYear++; }
        }
        <a href="@Url.GenerateExpenseLink("Expenses","Index", Model, new { SelectedMonth = prevMonth, SelectedYear = prevYear })">Previous</a>
        <a href="@Url.GenerateExpenseLink("Expenses","Index", Model, new { SelectedMonth = nextMonth, SelectedYear = nextYear })">Next</a>
    </div>
</div>